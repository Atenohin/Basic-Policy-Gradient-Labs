import gym
from gym import Wrapper
from gym import error, version
import os, json, logging, numpy as np, six

FILE_PREFIX = 'openaigym'
MANIFEST_PREFIX = FILE_PREFIX + '.manifest'

class FeatureInverter(Wrapper):
    def __init__(self, env, f1, f2):
        super(FeatureInverter, self).__init__(env)
        self.f1 = f1
        self.f2 = f2

        low_space = env.observation_space.low
        high_space = env.observation_space.high
        tmp = low_space[self.f1]
        low_space[self.f1] = low_space[self.f2]
        low_space[self.f2] = tmp
        tmp = high_space[self.f1]
        high_space[self.f1] = high_space[self.f2]
        high_space[self.f2] = tmp
        self.observation_space.low = low_space
        self.observation_space.high = high_space

    def _step(self, action):
        observation, reward, done, info = self.env.step(action)
        tmp = observation[self.f1]
        observation[self.f1] = observation[self.f2]
        observation[self.f2] = tmp
        return observation, reward, done, info

    def _reset(self, **kwargs):
        observation = self.env.reset(**kwargs)
        tmp = observation[self.f1]
        observation[self.f1] = observation[self.f2]
        observation[self.f2] = tmp
        return observation

    def _env_info(self):
        env_info = {
            'gym_version': version.VERSION,
        }
        if self.env.spec:
            env_info['env_id'] = self.env.spec.id
        return env_info
